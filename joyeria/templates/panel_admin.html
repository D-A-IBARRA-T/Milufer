{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Milufer - Panel Admin</title>
  <link rel="stylesheet" href="{% static 'panel_admin.css' %}">
</head>
<body>
  <header>
    <h1>MILUFER</h1>
    <div class="header-buttons">
      <a href="{% url 'admin:joyeria_producto_add' %}" class="btn-header">Añadir producto</a>
      <button id="statsBtn" class="btn-header">Estadísticas</button>
      <a href="{% url 'logout' %}" class="btn-header">Cerrar sesión</a>
    </div>
  </header>

  <div class="container">
    <div class="search-bar">
      <input type="text" id="search" placeholder="Buscar producto..." onkeyup="filtrar()">
    </div>

    <div class="productos-grid" id="grid">
      {% for p in productos %}
      <div class="producto-card">
        {% if p.imagen %}
          <img src="{{ p.imagen.url }}" alt="{{ p.nombre }}">
        {% else %}
          <div class="sin-imagen">Sin foto</div>
        {% endif %}
        <h3>{{ p.nombre }}</h3>
        <p class="precio">$ {{ p.precio }}</p>
        <div class="acciones">
          <a href="{% url 'admin:joyeria_producto_change' p.id %}" class="btn-edit">Editar</a>
          <a href="{% url 'admin:joyeria_producto_delete' p.id %}" class="btn-delete" 
             onclick="return confirm('¿Eliminar {{ p.nombre }} para siempre?')">Eliminar</a>
        </div>
      </div>
      {% empty %}
      <p class="no-productos">Aún no tenés productos. ¡Empezá a subir!</p>
      {% endfor %}
    </div>
  </div>

  <!-- Modal Estadísticas -->
  <div id="statsModal" class="modal">
    <div class="modal-content">
      <span class="close">×</span>
      <h2>Estadísticas</h2>
      <p>Total de productos: <strong>{{ productos|length }}</strong></p>
      <p>Productos visibles en tienda: <strong>{{ productos|length }}</strong></p>
    </div>
  </div>

  <script>
    // Abrir modal
    document.getElementById('statsBtn').onclick = () => {
      document.getElementById('statsModal').style.display = 'flex';
    };
    // Cerrar modal
    document.querySelector('.close').onclick = () => {
      document.getElementById('statsModal').style.display = 'none';
    };
    window.onclick = (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    };

    // Filtro en vivo
    function filtrar() {
      let texto = document.getElementById('search').value.toLowerCase();
      let cards = document.getElementsByClassName('producto-card');
      for (let card of cards) {
        let nombre = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = nombre.includes(texto) ? '' : 'none';
      }
    }
  </script>
</body>
</html>